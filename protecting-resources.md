---

copyright:
  years: 2017, 2018
lastupdated: "2018-03-16"

---
{:new_window: target="_blank"}
{:shortdesc: .shortdesc}
{:screen: .screen}
{:codeblock: .codeblock}
{:tip: .tip}


# Securing back-end resources
{: #secure-back-end}

You can use the {{site.data.keyword.appid_short_notm}} server SDKs to protect and access endpoints in your apps. You can also use the client SDKs to access protected resources.
{: shortdesc}

Calling a protected resource starts the login widget, if necessary. If a valid token was already obtained, the login widget is not started, and the resource is accessed directly.
{: tip}

## Protecting resources in Liberty for Java
{: #protecting-liberty}

You can use {{site.data.keyword.appid_short_notm}} to protect endpoints in your IBM Liberty for Java apps. Liberty for Java has the built-in ability to handle Open ID Connect (OIDC) requests.
{: shortdesc}



Before you begin:
* You need an existing, unbound, <a href="https://console.bluemix.net/catalog/starters/liberty-for-java" target="_blank">{{site.data.keyword.Bluemix_notm}} Liberty for Java app <img src="../../icons/launch-glyph.svg" alt="External link icon"></a>. To become familiar with developing Liberty for Java apps, see [the docs](/docs/runtimes/liberty/index.html).
* Be sure that you have <a href="https://maven.apache.org/download.cgi" target="_blank">Apache Maven <img src="../../icons/launch-glyph.svg" alt="External link icon"></a> installed.
* Learn about how OIDC works with Liberty for Java.



To protect your resources:

1. Download the Liberty for Java sample from the UI. The sample contains a compressed file with the standard Liberty files.
2. Open terminal at the directory where you extracted the sample.
3. Log in to {{site.data.keyword.Bluemix_notm}} by using the Cloud Foundry command line. When prompted, input your credentials.
  ```
  cf login
  ```
  {: codeblock}

4. Deploy the app. Running the following command creates a Liberty for Java instance with a name that is related to the tenant ID.
  ```
  cf push
  ```
  {: codeblock}

5. Bind your service instance to the new Liberty for Java instance, and redeploy the app.
6. Open your app in a browser and login by using your credentials to review authentication activities.

## Protecting resources in Node.js
{: #protecting-resources-nodesdk}

The {{site.data.keyword.appid_short_notm}} server SDK provides an ApiStrategy passport strategy that is used in back-end apps that are deployed on {{site.data.keyword.Bluemix_notm}}. To protect your app from unauthorized access, you must instrument your Node.js server with the ApiStrategy. The `appid-serversdk-nodejs npm module` provides the ApiStrategy passport strategy and the verification method to validate the access token and ID token that are issued by {{site.data.keyword.appid_short_notm}}.
{: shortdesc}

The {{site.data.keyword.appid_short_notm}} server SDK uses the <a href="http://passportjs.org/" target="_blank">Passport framework <img src="../../icons/launch-glyph.svg" alt="External link icon"></a> to enforce authorization.

The following snippet demonstrates how to use `APIStrategy` in a simple Express app to protect the `/protected` endpoint GET methods.
  ```JavaScript

  var express = require('express');
  var passport = require('passport');
  var APIStrategy = require('bluemix-appid').APIStrategy;

  passport.use(new APIStrategy());
  var app = express();
  app.use(passport.initialize());

  app.get('/protected', passport.authenticate('APIStrategy.STRATEGY_NAME', {session: false }),
      function(request, response){
          console.log("Securty context", request.securityContext)    
          response.send(200, "Success!");
      }
  );

  app.listen(process.env.PORT);
  ```
  {: codeblock}


## Protecting resources with the Swift SDK
{: #requesting-swift}

You can use {{site.data.keyword.appid_short_notm}} to protect your server side resources by using the Swift SDK.
{: shortdesc}

The {{site.data.keyword.appid_short_notm}} Swift server SDK provides an API protection middleware plugin that is used to protect your back-end apps. By associating your APIs with the middleware, you can protect your app from unauthorized access. After the API is protected, the middleware ensures that the tokens that are generated by {{site.data.keyword.appid_short_notm}} are validated. You can then modify the behavior of the API depending on the validation results.

See the following code snippet for an example of how to protect the `/protectedendpoint` API.

```Swift
import Foundation
import Kitura              // server
import Credentials         // middleware
import BluemixAppID        // SDK

// setup routes
let router = Router()

// mandatory option to be passed in if app not deployed on IBM Cloud
let options = [
    "oauthServerUrl": "https://appid-oauth.ng.bluemix.net/oauth/v3/d8438de6-c325-4956-ad34-abd49194affd",
]
let apiCreds = Credentials()

// Minimum macOS version required
if #available(OSX 10.12, *) {

    // setup API protection
    let apiKituraCredentialsPlugin = APIKituraCredentialsPlugin(options: options)
    apiCreds.register(plugin: apiKituraCredentialsPlugin)

    // associate route with API protection
    router.all(middleware: apiCreds)

    // create protected API
    router.get("/protectedendpoint") { request, response, next in

        response.headers["Content-Type"] = "text/html; charset=utf-8"
        do {
            if let userProfile = request.userProfile  {
                try response.status(.OK).send(
                    "<!DOCTYPE html><html><body>" +
                        "Welcome " + userProfile.displayName  +
                        "! You are logged in with " + userProfile.provider + ".
" +
                    "</body></html>\n\n").end()
                next()
                return
            }
            try response.status(.unauthorized).send(
                "<!DOCTYPE html><html><body>” + “You are not authorized!" +
                "</body></html>\n\n").end()
        }
        catch {}
        next()
    }

    // Start server
    Kitura.addHTTPServer(onPort: 8090, with: router)

    Kitura.run()  
}
```


## Accessing protected resources with the iOS Swift SDK
{: #requesting-swift}

You can use {{site.data.keyword.appid_short_notm}} to protect endpoints in your iOS Swift apps.
{: shortdesc}

1. Import BMSCore.
  ```swift
  import BMSCore
  ```
  {: codeblock}

2. Invoke a protected resource request.
  ```swift
  BMSClient.sharedInstance.initialize(bluemixRegion: AppID.<region>)
  BMSClient.sharedInstance.authorizationManager = AppIDAuthorizationManager(appid:AppID.sharedInstance)
  var request:Request =  Request(url: "<your protected resource url>")
  request.send(completionHandler: {(response:Response?, error:Error?) in
      //code handling the response here
  })
  ```
  {: codeblock}


## Accessing protected resources with the Android SDK
{: #requesting-android}

You can use {{site.data.keyword.appid_short_notm}} to protect endpoints in your Android apps.
{: shortdesc}

1. Invoke a protected resource request.
  ```java
  BMSClient bmsClient = BMSClient.getInstance();
  bmsClient.initialize(getApplicationContext(), AppID.REGION_UK);

  AppIDAuthorizationManager appIdAuthMgr = new AppIDAuthorizationManager(AppID.getInstance())
  bmsClient.setAuthorizationManager(appIdAuthMgr);

  Request request = new Request("<your protected resource url>", Request.GET);
  request.send(this, new ResponseListener() {
  @Override
  public void onSuccess (Response response) {
     //code handling the response here
  }
  @Override
  public void onFailure (Response response, Throwable t, JSONObject extendedInfo) {
      //code handling the failure here
  });
  ```
  {: codeblock}
